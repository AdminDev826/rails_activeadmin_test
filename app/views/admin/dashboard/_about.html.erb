<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>jsTree test</title>
  <!-- 2 load the theme CSS file -->
</head>
<body>
  <!-- 3 setup a container element -->
  <div id="loader-wrapper">
      <div id="loader"></div>

      <div class="loader-section section-left"></div>
            <div class="loader-section section-right"></div>

    </div>
  <div id="jstree"> 
    <!-- in this example the tree is populated from inline HTML -->
    <ul>
      <li>Root node 1
        <ul>
          <li id="child_node_1">Child node 1</li>
          <li>Child node 2</li>
        </ul>
      </li>
      <li>Root node 2</li>
    </ul>
  </div>
  <span class="context-menu-one btn btn-neutral" data-value="sdf">right click me</span>

  <script>
  jQuery(function ($) {
    // 6 create an instance when the DOM is ready
    // $('#jstree').jstree();
    // $('#jstree').jstree({
    //   'core' : {
    //     'data' : function (obj, cb) {
    //         cb.call(this,
    //           ['Root 1', 'Root 2']);
    //     }
    //   }
    // });
    setTimeout(function(){
      $('body').addClass('loaded');
    }, 3000);
    
    $.contextMenu({
      selector: ".context-menu-one",
      trigger: 'left',
      callback: function(key, options) {
        console.log($(this).data("value"));
        var m = "clicked: " + key;
        window.console && console.log(m) || alert(m); 
      },

      items: {
        "edit": {name: "Edit", icon: "add"},
        "cut": {name: "Beer", icon: "edit"},
        "copy": {name: "Cloud download", icon: "loading"},
        "paste": {name: "Certificate", icon: "paste"}
      }
    }); 


    $('#jstree').jstree({
      'core' : {
        'data' : {
          'url' : function (node) {
            var url;
            console.log(node.parent);
            if(node.parent != '#' && node.parent != null){
              url = '/admin/dashboard/get_tree_data?pid=' + node.original.pid
            }else{
              var item_id = node.original != null ? node.original.item_id : '';
              url = '/admin/dashboard/get_tree_data?item_id='+ item_id
            }
            return url;
          }
        },
        'check_callback': function(o, n, p, i, m){
          if (this.get_node(n).parent === this.get_node(p).id && this.get_node(n).parents.length > 1) 
            return true;
          else 
            return false;
        }
      },
      "checkbox": {three_state: false, whole_node: false, tie_selection: false},
      "plugins": ["dnd", "checkbox"]
    }).bind("move_node.jstree", function (e, data) {
      if(data.old_parent === data.parent){
        var parent_node = $("#jstree").jstree(true).get_node(data.parent);
        console.log(parent_node);
        console.log(parent_node.original);
        console.log(parent_node.children);
        $("#jstree").find("#" + data.parent + " li").each(function(index) {
          console.log($(this).text());
        });
        return true;
      }else {
        return false;
      }
    }).bind("check_node.jstree uncheck_node.jstree", function(e, data){
      var url = "url?pid=" + data.node.original.pid;
      console.log(url);
      // alert(data.node.id+"--"+data.node.text+(data.node.state.checked?' Checked': ' Not checked'));
    });
  });
  </script>
</body>
</html>